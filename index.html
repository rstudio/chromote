<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Headless Chrome Web Browser Interface • chromote</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Headless Chrome Web Browser Interface">
<meta name="description" content="An implementation of the Chrome DevTools Protocol, for controlling a headless Chrome web browser.">
<meta property="og:description" content="An implementation of the Chrome DevTools Protocol, for controlling a headless Chrome web browser.">
<!-- See https://stackoverflow.com/questions/1865837/whats-the-difference-between-window-location-and-window-location-replace — we use .replace() because we don't want the old url to appear in the browser history. --><script>
  if (!/(\/|html?)$/.test(window.location.href)){
    window.location.replace(window.location.href + '/');
  }
</script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">chromote</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/chromote/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="chromote-headless-chrome-remote-interface">Chromote: Headless Chrome Remote Interface<a class="anchor" aria-label="anchor" href="#chromote-headless-chrome-remote-interface"></a>
</h1></div>
<!-- badges: start -->

<p>Chromote is an R implementation of the <a href="https://chromedevtools.github.io/devtools-protocol/" class="external-link">Chrome DevTools Protocol</a>. It works with Chrome, Chromium, Opera, Vivaldi, and other browsers based on <a href="https://www.chromium.org/" class="external-link">Chromium</a>. By default it uses Google Chrome (which must already be installed on the system). To use a different browser, see <a href="#specifying-which-browser-to-use">Specifying which browser to use</a>.</p>
<p>Chromote is not the only R package that implements the Chrome DevTools Protocol. Here are some others:</p>
<ul>
<li>
<a href="https://github.com/RLesur/crrri" class="external-link">crrri</a> by Romain Lesur and Christophe Dervieux</li>
<li>
<a href="https://github.com/hrbrmstr/decapitated/" class="external-link">decapitated</a> by Bob Rudis</li>
<li>
<a href="https://github.com/milesmcbain/chradle" class="external-link">chradle</a> by Miles McBain</li>
</ul>
<p>The interface to Chromote is similar to <a href="https://github.com/cyrus-and/chrome-remote-interface" class="external-link">chrome-remote-interface</a> for node.js.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"chromote"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Development</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"rstudio/chromote"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>This will start a headless browser and open an interactive viewer for it in a normal browser, so that you can see what the headless browser is doing.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/chromote/">chromote</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In a web browser, open a viewer for the headless browser. Works best with</span></span>
<span><span class="co"># Chromium-based browsers.</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The browser can be given <em>commands</em>, as specified by the <a href="https://chromedevtools.github.io/devtools-protocol/" class="external-link">Chrome DevTools Protocol</a>. For example, <code>$Browser$getVersion()</code> (which corresponds to the <a href="https://chromedevtools.github.io/devtools-protocol/tot/Browser/#method-getVersion" class="external-link">Browser.getVersion</a> in the API docs) will query the browser for version information:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $protocolVersion</span></span>
<span><span class="co">#&gt; [1] "1.3"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $product</span></span>
<span><span class="co">#&gt; [1] "HeadlessChrome/98.0.4758.102"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $revision</span></span>
<span><span class="co">#&gt; [1] "@273bf7ac8c909cde36982d27f66f3c70846a3718"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $userAgent</span></span>
<span><span class="co">#&gt; [1] "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/98.0.4758.102 Safari/537.36"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $jsVersion</span></span>
<span><span class="co">#&gt; [1] "9.8.177.11"</span></span></code></pre></div>
<p>If you have the viewer open and run the following, you’ll see the web page load in the viewer:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span><span class="op">)</span></span></code></pre></div>
<p>In the official Chrome DevTools Protocol (CDP) documentation, this is the <a href="https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-navigate" class="external-link"><code>Page.navigate</code></a> command.</p>
<p>In addition to full support of the CDP, <code>ChromoteSession</code> objects also some convenience methods, like <code>$screenshot()</code>. (See the Examples section below for more information about screenshots.)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Saves to screenshot.png</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Takes a screenshot of elements picked out by CSS selector</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"sidebar.png"</span>, selector <span class="op">=</span> <span class="st">".sidebar"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/sidebar.png"></p>
<p><strong>Note:</strong> All members of <code>Chromote</code> and <code>ChromoteSession</code> objects which start with a capital letter (like <code>b$Page</code>, <code>b$DOM</code>, and <code>b$Browser</code>) correspond to domains from the Chrome DevTools Protocol, and are documented in the <a href="https://chromedevtools.github.io/devtools-protocol/" class="external-link">official CDP site</a>. All members which start with a lower-case letter (like <code>b$screenshot</code> and <code>b$close</code>) are not part of the Chrome DevTools Protocol, and are specific to <code>Chromote</code> and <code>ChromoteSession</code>.</p>
<p>Here is an example of how to use Chromote to find the position of a DOM element using <a href="https://chromedevtools.github.io/devtools-protocol/tot/DOM/#method-getBoxModel" class="external-link">DOM.getBoxModel</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="st">".sidebar"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">nodeId</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ model:List of 6</span></span>
<span><span class="co">#&gt;   ..$ content:List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 128</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 292</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 292</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 128</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ padding:List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ border :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ margin :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : int 15</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 1030</span></span>
<span><span class="co">#&gt;   .. ..$ : int 15</span></span>
<span><span class="co">#&gt;   .. ..$ : num 1030</span></span>
<span><span class="co">#&gt;   ..$ width  : int 195</span></span>
<span><span class="co">#&gt;   ..$ height : int 960</span></span></code></pre></div>
<p>Or you can do the same thing by chaining commands together with a magrittr pipe:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="st">".sidebar"</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">nodeId</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ model:List of 6</span></span>
<span><span class="co">#&gt;   ..$ content:List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 128</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 292</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 292</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 128</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ padding:List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ border :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ margin :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : int 15</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 1030</span></span>
<span><span class="co">#&gt;   .. ..$ : int 15</span></span>
<span><span class="co">#&gt;   .. ..$ : num 1030</span></span>
<span><span class="co">#&gt;   ..$ width  : int 195</span></span>
<span><span class="co">#&gt;   ..$ height : int 960</span></span></code></pre></div>
<div class="section level3">
<h3 id="creating-new-tabs-and-managing-the-process">Creating new tabs and managing the process<a class="anchor" aria-label="anchor" href="#creating-new-tabs-and-managing-the-process"></a>
</h3>
<p>To create a new tab/window:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="fu">new_session</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Once it’s created, you can perform operations with the new tab without affecting the first one.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b1</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b1</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://github.com/rstudio/chromote"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $frameId</span></span>
<span><span class="co">#&gt; [1] "714439EBDD663E597658503C86F77B0B"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $loaderId</span></span>
<span><span class="co">#&gt; [1] "F39339CBA7D1ACB83618FEF40C3C7467"</span></span></code></pre></div>
<p>To close a browser tab/window, you can run:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b1</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This is different from shutting down the browser process. If you call <code>b$close()</code>, the browser process will still be running, even if all tabs have been closed. If all tabs have been closed, you can still create a new tab by calling <code>b1$new_session()</code>.</p>
<p>To shut down the process, call:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b1</span><span class="op">$</span><span class="va">parent</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><code>b1$parent</code> is a <code>Chromote</code> object (as opposed to <code>ChromoteSession</code>), which represents the browser as a whole. This is explained in <a href="#the-chromote-object-model">The Chromote object model</a>.</p>
</div>
<div class="section level3">
<h3 id="commands-and-events">Commands and Events<a class="anchor" aria-label="anchor" href="#commands-and-events"></a>
</h3>
<p>The Chrome DevTools Protocol has two types of methods: <em>commands</em> and <em>events</em>. The methods used in the previous examples are commands. That is, they tell the browser to do something; the browser does it, and then sends back some data.</p>
<p>Events are quite different from commands. When, for example, you run <code>b$Page$loadEventFired()</code>, it does not send a message to the browser. Rather, this method tells the R process to wait until it receives a <code>Page.loadEventFired</code> message from the browser.</p>
<p>Here is an example of how that event can be used. Note that these two lines of code must be run together, without any delay at all (this can be enforced by wrapping both lines of code in <code>{ .... }</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Send a command to navigate to a page</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $frameId</span></span>
<span><span class="co">#&gt; [1] "0ADE3CFBAF764B0308ADE1ACCC33358B"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $loaderId</span></span>
<span><span class="co">#&gt; [1] "112AF4AC0C13FF4A95BED8173C3F4C7F"</span></span>
<span></span>
<span><span class="co"># Wait for the Page.loadEventFired event</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $timestamp</span></span>
<span><span class="co">#&gt; [1] 680.7603</span></span></code></pre></div>
<p>After running these two lines, the R process will be blocked. While it’s blocked, the browser will load the page, and then send a message to the R process saying that the <code>Page.loadEventFired</code> event has occurred. The message looks something like this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">{</span><span class="dt">"method"</span><span class="fu">:</span><span class="st">"Page.loadEventFired"</span><span class="fu">,</span><span class="dt">"params"</span><span class="fu">:{</span><span class="dt">"timestamp"</span><span class="fu">:</span><span class="fl">699232.345338</span><span class="fu">}}</span></span></code></pre></div>
<p>After the R process receives this message, the function returns the value, which looks like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="sc">$</span>timestamp</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">699232.3</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> This sequence of commands, with <code>Page$navigate()</code> and then <code>Page$loadEventFired()</code> will not work 100% of the time. See <a href="#loading-a-page-reliably">Loading a Page Reliably</a> for more information.</p>
</blockquote>
<blockquote>
<p><strong>Technical note:</strong> Chromote insulates the user from some of the details of how the CDP implements event notifications. Event notifications are not sent from the browser to the R process by default; you must first send a command to enable event notifications for a domain. For example <code>Page.enable</code> enables event notifications for the <code>Page</code> domain – the browser will send messages for <em>all</em> <code>Page</code> events. (See the Events section in <a href="https://chromedevtools.github.io/devtools-protocol/tot/Page/" class="external-link">this page</a>). These notifications will continue to be sent until the browser receives a <code>Page.disable</code> command.</p>
<p>By default, Chromote hides this implementation detail. When you call <code>b$Page$loadEventFired()</code>, Chromote sends a <code>Page.enable</code> command automatically, and then waits until it receives the <code>Page.loadEventFired</code> event notification. Then it sends a <code>Page.disable</code> command.</p>
<p>Note that in asynchronous mode, the behavior is slightly more sophisticated: it maintains a counter of how many outstanding events it is waiting for in a given domain. When that count goes from 0 to 1, it sends the <code>X.enable</code> command; when the count goes from 1 to 0, it sends the <code>X.disable</code> command. For more information, see the <a href="#async-events">Async events</a> section.</p>
<p>If you do not want automatic event enabling and disabling, then when creating the ChromoteSession object, use <code>ChromoteSession$new(auto_events = FALSE)</code>.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="the-chromote-object-model">The Chromote object model<a class="anchor" aria-label="anchor" href="#the-chromote-object-model"></a>
</h3>
<p>There are two R6 classes that are used to represent the Chrome browser. One is <code>Chromote</code>, and the other is <code>ChromoteSession</code>. A <code>Chromote</code> object represents the browser as a whole, and it can have multiple <em>targets</em>, which each represent a browser tab. In the Chrome DevTools Protocol, each target can have one or more debugging <em>sessions</em> to control it. A <code>ChromoteSession</code> object represents a single <em>session</em>.</p>
<p>When a <code>ChromoteSession</code> object is instantiated, a target is created, then a session is attached to that target, and the <code>ChromoteSession</code> object represents the session. (It is possible, though not very useful, to have multiple <code>ChromoteSession</code> objects connected to the same target, each with a different session.)</p>
<p>A <code>Chromote</code> object can have any number of <code>ChromoteSession</code> objects as children. It is not necessary to create a <code>Chromote</code> object manually. You can simply call:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>and it will automatically create a <code>Chromote</code> object if one has not already been created. The Chromote package will then designate that <code>Chromote</code> object as the <em>default</em> Chromote object for the package, so that any future calls to <code>ChromoteSession$new()</code> will automatically use the same <code>Chromote</code>. This is so that it doesn’t start a new browser for every <code>ChromoteSession</code> object that is created.</p>
<p>In the Chrome DevTools Protocol, most commands can be sent to individual sessions using the <code>ChromoteSession</code> object, but there are some commands which can only be sent to the overall browser, using the <code>Chromote</code> object.</p>
<p>To access the parent <code>Chromote</code> object from a <code>ChromoteSession</code>, you can simply use <code>$parent</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">parent</span></span></code></pre></div>
<p>With a <code>Chromote</code> object, you can get a list containing all the <code>ChromoteSession</code>s, with <code>$get_sessions()</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">$</span><span class="fu">get_sessions</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Normally, subsequent calls to <code>ChromoteSession$new()</code> will use the existing <code>Chromote</code> object. However, if you want to start a new browser process, you can manually create a <code>Chromote</code> object, then spawn a session from it; or you can pass the new <code>Chromote</code> object to <code>ChromoteSession$new()</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cm</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/Chromote.html">Chromote</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="va">cm</span><span class="op">$</span><span class="fu">new_session</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or:</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>parent <span class="op">=</span> <span class="va">cm</span><span class="op">)</span></span></code></pre></div>
<p>Note that if you use either of these methods, the new <code>Chromote</code> object will <em>not</em> be set as the default that is used by future calls to <code>ChromoteSesssion$new()</code>. See <a href="#specifying-which-browser-to-use">Specifying which browser to use</a> for information on setting the default <code>Chromote</code> object.</p>
<p>There are also the following classes which represent the browser at a lower level:</p>
<ul>
<li>
<code>Browser</code>: This represents an instance of a browser that supports the Chrome DevTools Protocol. It contains information about how to communicate with the Chrome browser. A <code>Chromote</code> object contains one of these.</li>
<li>
<code>Chrome</code>: This is a subclass of <code>Browser</code> that represents a local browser. It extends the <code>Browser</code> class with a <code><a href="http://processx.r-lib.org/reference/process.html" class="external-link">processx::process</a></code> object, which represents the browser’s system process.</li>
<li>
<code>ChromeRemote</code>: This is a subclass of <code>Browser</code> that represents a browser running on a remote system.</li>
</ul>
</div>
<div class="section level3">
<h3 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h3>
<p>Calling <code>b$debug_messages(TRUE)</code> will enable the printing of all the JSON messages sent between R and Chrome. This can be very helpful for understanding how the Chrome DevTools Protocol works.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">parent</span><span class="op">$</span><span class="fu">debug_messages</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span><span class="op">)</span></span>
<span><span class="co">#&gt; SEND {"method":"Page.navigate","params":{"url":"https://www.r-project.org/"},"id":53,"sessionId":"12CB6B044A379DA0BDCFBBA55318247C"}</span></span>
<span><span class="co">#&gt; $frameId</span></span>
<span><span class="co">#&gt; [1] "BAAC175C67E55886207BADE1776E7B1F"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $loaderId</span></span>
<span><span class="co">#&gt; [1] "66DED3DF9403DA4A307444765FDE828E"</span></span>
<span></span>
<span><span class="co"># Disable debug messages</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">parent</span><span class="op">$</span><span class="fu">debug_messages</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="synchronous-vs-asynchronous-usage">Synchronous vs. asynchronous usage<a class="anchor" aria-label="anchor" href="#synchronous-vs-asynchronous-usage"></a>
</h3>
<p>By default, when you call methods from a <code>Chromote</code> or <code>ChromoteSession</code> object, it operates in <em>synchronous</em> mode. For example, when you call a command function (like <code>b$Page$navigate()</code>), a command message is sent to the headless browser, the headless browser executes that command, and it sends a response message back. When the R process receives the response, it converts it from JSON to an R object and the function returns that value. During this time, the R process is blocked; no other R code can execute.</p>
<p>The methods in Chromote/ChromoteSession objects can also be called in <em>asynchronous</em> mode. In async mode, a command function fires off a message to the browser, and then the R process continues running other code; when the response comes back at some time in the future, the R process calls another function and passes the response value to it.</p>
<p>There are two different ways of using async with Chromote. The first is with <a href="https://rstudio.github.io/promises/" class="external-link">promises</a> (note that these are not the regular R-language promises; these are similar to JavaScript promises for async programming.) The second way is with callbacks: you call methods with a <code>callback_</code> argument. Although callbacks are initially easier to use than promises, once you start writing more complex code, managing callbacks becomes very difficult, especially when error handling is involved. For this reason, this document will focus mostly on promises instead of callback-style programming.</p>
<p>When Chromote methods are called in synchronous mode, under the hood, they are implemented with asynchronous functions, and then waiting for the asynchronous functions to resolve.</p>
<blockquote>
<p><strong>Technical note about the event loop</strong>: When methods are called asynchronously, the R process will run callbacks and promises using an event loop provided by the <a href="https://github.com/r-lib/later" class="external-link">later</a> package. This event loop is very similar to the one used in JavaScript, which is explained in depth by <a href="https://youtu.be/8aGhZQkoFbQ" class="external-link">Philip Roberts in this video</a>. One important difference between JavaScript’s event loop and the one provided by <strong>later</strong>’s is that in JavaScript, the event loop only runs when the call stack is empty (essentially, when the JS runtime is idle); with <strong>later</strong> the event loop similarly runs when the call stack is empty (when the R console is idle), but it can also be run at any point by calling <code><a href="https://r-lib.github.io/later/reference/run_now.html" class="external-link">later::run_now()</a></code>.</p>
<p>There is another important difference between the JS event loop and the one used by Chromote: Chromote uses <em>private event loops</em> provided by <a href="https://github.com/r-lib/later" class="external-link">later</a>. Running the private event loop with <code>run_now()</code> will not interfere with the global event loop. This is crucial for being able to run asynchronous code in a way that appears synchronous.</p>
</blockquote>
<div class="section level4">
<h4 id="why-async">Why async?<a class="anchor" aria-label="anchor" href="#why-async"></a>
</h4>
<p>The synchronous API is easier to use than the asynchronous one. So why would you want to use the async API? Here are some reasons:</p>
<ul>
<li>The async API allows you to send commands to the browser that may take some time for the browser to complete, and they will not block the R process from doing other work while the browser executes the command.</li>
<li>The async API lets you send commands to multiple browser “tabs” and let them work in parallel.</li>
</ul>
<p>On the other hand, async programming can make it difficult to write code that proceeds in a straightforward, linear manner. Async programming may be difficult to use in, say, an analysis script.</p>
<p>When using Chromote interactively at the R console, it’s usually best to just call methods synchronously. This fits well with a iterative, interactive data analysis workflow.</p>
<p>When you are <em>programming</em> with Chromote instead of using it interactively, it is in many cases better to call the methods asynchronously, because it allows for better performance. In a later section, we’ll see how to write asynchronous code with Chromote that can be run either synchronously or asynchronously. This provides the best of both worlds.</p>
</div>
<div class="section level4">
<h4 id="async-commands">Async commands<a class="anchor" aria-label="anchor" href="#async-commands"></a>
</h4>
<p>When a method is called in synchronous mode, it blocks until the browser sends back a response, and then it returns the value, converted from JSON to an R object. For example:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Synchronous</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ protocolVersion: chr "1.3"</span></span>
<span><span class="co">#&gt;  $ product        : chr "HeadlessChrome/98.0.4758.102"</span></span>
<span><span class="co">#&gt;  $ revision       : chr "@273bf7ac8c909cde36982d27f66f3c70846a3718"</span></span>
<span><span class="co">#&gt;  $ userAgent      : chr "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/98.0.4758.102 Safari/537.36"</span></span>
<span><span class="co">#&gt;  $ jsVersion      : chr "9.8.177.11"</span></span></code></pre></div>
<p>In async mode, there are two ways to use the value that the browser sends to the R process. One is to use the <code>callback_</code> argument with <code>wait_=FALSE</code>. The <code>wait_=FALSE</code> tells it to run the command in async mode; instead of returning the value from the browser, it returns a promise. For example:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Async with callback</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span>, callback_ <span class="op">=</span> <span class="va">str</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Promise [pending]&gt;</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ protocolVersion: chr "1.3"</span></span>
<span><span class="co">#&gt;  $ product        : chr "HeadlessChrome/98.0.4758.102"</span></span>
<span><span class="co">#&gt;  $ revision       : chr "@273bf7ac8c909cde36982d27f66f3c70846a3718"</span></span>
<span><span class="co">#&gt;  $ userAgent      : chr "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/98.0.4758.102 Safari/537.36"</span></span>
<span><span class="co">#&gt;  $ jsVersion      : chr "9.8.177.11"</span></span></code></pre></div>
<p>Notice that the function returned <code>&lt;Promise [pending]&gt;</code>, and then it printed out the data. We’ll come back to the promise part.</p>
<blockquote>
<p><strong>Technical note:</strong> When you pass a function as <code>callback_</code>, that function is used as the first step in the promise chain that is returned.</p>
</blockquote>
<p>If you run the command in a code block (or a function), the entire code block will finish executing before the callback can be executed. For example:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">{</span></span>
<span>  <span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span>, callback_ <span class="op">=</span> <span class="va">str</span><span class="op">)</span></span>
<span>  <span class="fl">1</span><span class="op">+</span><span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ protocolVersion: chr "1.3"</span></span>
<span><span class="co">#&gt;  $ product        : chr "HeadlessChrome/98.0.4758.102"</span></span>
<span><span class="co">#&gt;  $ revision       : chr "@273bf7ac8c909cde36982d27f66f3c70846a3718"</span></span>
<span><span class="co">#&gt;  $ userAgent      : chr "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/98.0.4758.102 Safari/537.36"</span></span>
<span><span class="co">#&gt;  $ jsVersion      : chr "9.8.177.11"</span></span></code></pre></div>
<p>In the code above, it executes the <code>1+1</code> and returns the value before the <code>str</code> callback can be executed on the message from the browser.</p>
<p>If you want to store the value from the browser, you can write a callback that stores the value like so:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This will extract the product field</span></span>
<span><span class="va">product</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span>, callback_ <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">msg</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">product</span> <span class="op">&lt;&lt;-</span> <span class="va">msg</span><span class="op">$</span><span class="va">product</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Promise [pending]&gt;</span></span>
<span><span class="co"># Wait for a moment, then run:</span></span>
<span><span class="va">product</span></span>
<span><span class="co">#&gt; [1] "HeadlessChrome/98.0.4758.102"</span></span></code></pre></div>
<p>But to get the value, you need to wait for the callback to execute before you can use the value. Waiting for a value is simple when running R interactively – you can just add a <code>message("message arrived")</code> call in the callback and wait for it before running the next line of code – but waiting for the value is not easy to do using ordinary straight-line coding. Fortunately, Chromote has a way to wait for async operations, which we’ll see later.</p>
<p>The other way of using the value is to use <em>promises</em>. If <code>wait_=FALSE</code> and no <code>callback_</code> is passed to the command, then it will simply return a promise. Promises have many advantages over plain old callbacks: they are easier to chain, and they provide better error-handling capabilities. You can <em>chain</em> more steps to the promise: when the promise resolves – that is, when the message is received from the browser – it will run the next step in the promise chain.</p>
<p>Here’s an example that uses promises to print out the version information. Note that the surrounding curly braces are there to indicate that this whole thing must be run as a block without any idle time in between the function calls – if you were to run the code in the R console line-by-line, the browser would send back the message and the promise would resolve before you called <code>p$then()</code>, which is where you tell the promise what to do with the return value. (The curly braces aren’t strictly necessary – you could run the code inside the braces in a single paste operation and have the same effect.)</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">p</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">value</span><span class="op">$</span><span class="va">product</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Wait for a moment, then prints:</span></span>
<span><span class="co">#&gt; [1] "HeadlessChrome/98.0.4758.102"</span></span></code></pre></div>
<p>Here are some progressively more concise ways of achieving the same thing. As you work with promises, you will see these various forms of promise chaining. For more information, see the <a href="https://rstudio.github.io/promises/" class="external-link">promises documentation</a>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/promises/" class="external-link">promises</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Regular function pipe to then()</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rstudio.github.io/promises/reference/then.html" class="external-link">then</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">value</span><span class="op">$</span><span class="va">product</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Promise-pipe to anonymous function, which must be wrapped in parens</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span> <span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">value</span><span class="op">$</span><span class="va">product</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Promise-pipe to an expression (which gets converted to a function with the first argument `.`)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">product</span><span class="op">)</span> <span class="op">}</span></span>
<span></span>
<span><span class="co"># Promise-pipe to a named function, with parentheses</span></span>
<span><span class="va">print_product</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">msg</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">msg</span><span class="op">$</span><span class="va">product</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span> <span class="fu">print_product</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Promise-pipe to a named function, without parentheses</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span> <span class="va">print_product</span></span></code></pre></div>
<p>The earlier example where we found the dimensions of a DOM element using CSS selectors was done with the synchronous API and <code>%&gt;%</code> pipes. The same can be done in async mode by switching from the regular pipe to the promise-pipe, and calling all the methods with <code>wait_=FALSE</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="st">".sidebar"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">nodeId</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Or, more verbosely:</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">value</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="st">".sidebar"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">value</span><span class="op">$</span><span class="va">nodeId</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Each step in the promise chain uses the value from the previous step, via <code>.</code> or <code>value</code>. Note that not all asynchronous code works in such a linear, straightforward way. Sometimes it is necessary to save data from intermediate steps in a broader-scoped variable, if it is to be used in a later step in the promise chain.</p>
</div>
<div class="section level4">
<h4 id="turning-asynchronous-code-into-synchronous-code">Turning asynchronous code into synchronous code<a class="anchor" aria-label="anchor" href="#turning-asynchronous-code-into-synchronous-code"></a>
</h4>
<p>There may be times, especially when programming with Chromote, where you want to wait for a promise to resolve before continuing. To do this, you can use the Chromote or ChromoteSession’s <code>wait_for()</code> method.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A promise chain</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="st">".sidebar"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">nodeId</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">wait_for</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ model:List of 6</span></span>
<span><span class="co">#&gt;   ..$ content:List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 128</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 292</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 292</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 128</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ padding:List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ border :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ margin :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : int 15</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 1030</span></span>
<span><span class="co">#&gt;   .. ..$ : int 15</span></span>
<span><span class="co">#&gt;   .. ..$ : num 1030</span></span>
<span><span class="co">#&gt;   ..$ width  : int 195</span></span>
<span><span class="co">#&gt;   ..$ height : int 960</span></span></code></pre></div>
<p>This documentation will refer to this technique as <em>synchronizing</em> asynchronous code. The way that <code>wait_for()</code> works is that it runs the Chromote object’s private event loop until the promise has resolved. Because the event loop is <em>private</em>, running it will not interfere with the global event loop, which, for example, may used by Shiny to serve a web application.</p>
<p>The <code>$wait_for()</code> method will return the value from the promise, so instead of putting the <code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code> in the chain, you call <code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code> on the value returned by <code>$wait_for()</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="st">".sidebar"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">nodeId</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="fu">wait_for</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ model:List of 6</span></span>
<span><span class="co">#&gt;   ..$ content:List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 128</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 292</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 292</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 128</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ padding:List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ border :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   .. ..$ : num 112</span></span>
<span><span class="co">#&gt;   .. ..$ : num 988</span></span>
<span><span class="co">#&gt;   ..$ margin :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : int 15</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : int 28</span></span>
<span><span class="co">#&gt;   .. ..$ : num 308</span></span>
<span><span class="co">#&gt;   .. ..$ : num 1030</span></span>
<span><span class="co">#&gt;   .. ..$ : int 15</span></span>
<span><span class="co">#&gt;   .. ..$ : num 1030</span></span>
<span><span class="co">#&gt;   ..$ width  : int 195</span></span>
<span><span class="co">#&gt;   ..$ height : int 960</span></span></code></pre></div>
<p>There are some methods in Chromote and ChromoteSession objects which are written using asynchronous method calls, but conditionally use <code>wait_for()</code> so that they can be called either synchronously or asynchronously. The <code>$screenshot()</code> method works this way, for example. You can call <code>b$screenshot(wait_=TRUE)</code> (which is the default) for synchronous behavior, or <code>b$screenshot(wait_=FALSE)</code> for async behavior.</p>
<p>If you want to write a function that can be called in either sync or async mode, you can use this basic structure: First, construct a promise chain by calling the CDP methods with <code>wait_=FALSE</code>. Then, at the end, if the user used <code>wait_=TRUE</code>, wait for the promise to resolve; otherwise, simply return the promise.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getBoxModel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">b</span>, <span class="va">selector</span> <span class="op">=</span> <span class="st">"html"</span>, <span class="va">wait_</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>    <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="va">selector</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>    <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">nodeId</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">wait_</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="fu">wait_for</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">p</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Synchronous call</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">b</span>, <span class="st">".sidebar"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Asynchronous call</span></span>
<span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">b</span>, <span class="st">".sidebar"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>But, you might be wondering, if we want a synchronous API, why not simply write the synchronous code by calling the individual methods synchronously, and using a normal pipe to connect them, as in:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="st">".sidebar"</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getBoxModel</span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">nodeId</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>There are two reasons for this. The first is that this would require a duplication of all the code for the sync and async code paths. Another reason is that the internal async code can be written to send multiple independent command chains to the ChromoteSession (or multiple ChromoteSessions), and they will be executed concurrently. If there are multiple promise chains, you can do something like the following to wait for all of them to resolve:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Starting with promises p1, p2, and p3, create a promise that resolves only</span></span>
<span><span class="co"># after they have all been resolved.</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/promises/reference/promise_all.html" class="external-link">promise_all</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">wait_for</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="async-events">Async events<a class="anchor" aria-label="anchor" href="#async-events"></a>
</h2>
<p>In addition to <em>commands</em> The Chrome DevTools Protocol also has <em>events</em>. These are messages that are sent from the browser to the R process when various browser events happen.</p>
<p>As an example, it can be a bit tricky to find out when to take a screenshot. When you send the browser a command to navigate to a page, it sends a response immediately, but it may take several more seconds for it to actually finish loading that page. When it does, the <code>Page.loadEventFired</code> event will be fired.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Navigate and wait for Page.loadEventFired.</span></span>
<span><span class="co"># Note: these lines are put in a single code block to ensure that there is no</span></span>
<span><span class="co"># idle time in between.</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ timestamp: num 683</span></span></code></pre></div>
<p>With the synchronous API, the call to <code>b$Page$loadEventFired()</code> will block until Chromote receives a <code>Page.loadEventFired</code> message from the browser. However, with the async promise API, you would write it like this:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span> <span class="op"><a href="https://rstudio.github.io/promises/reference/pipes.html" class="external-link">%...&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">}</span></span>
<span></span>
<span><span class="co"># Or, more verbosely:</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>There will be a short delay after running the code before the value is printed.</p>
<p>However, even this is not perfectly reliable, because in some cases, the browser will navigate to the page before it receives the <code>loadEventFired</code> command from Chromote. If that happens, the load even will have already happened before the browser starts waiting for it, and it will hang. The correct way to deal with this is to issue the <code>loadEventFired</code> command <em>before</em> navigating to the page, and then wait for the <code>loadEventFired</code> promise to resolve.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is the correct way to wait for a page to load with async and then chain more commands</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A promise chain of more commands after the page has loaded</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>If you want to block until the page has loaded, you can once again use <code>wait_for()</code>. For example:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># wait_for returns the last value in the chain, so we can call str() on it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">b</span><span class="op">$</span><span class="fu">wait_for</span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ timestamp: num 683</span></span></code></pre></div>
<blockquote>
<p><strong>Technical note:</strong> The Chrome DevTools Protocol itself does not automatically enable event notifications. Normally, you would have to call the <code>Page.enable</code> method to turn on event notifications for the Page domain. However, Chromote saves you from needing to do this step by keeping track of how many callbacks there are for each domain. When the number of event callbacks for a domain goes from 0 to 1, Chromote automatically calls <code>$enable()</code> for that domain, and when it goes from 1 to 0, it it calls <code>$disable()</code>.</p>
</blockquote>
<p>In addition to async events with promises, they can also be used with regular callbacks. For example:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>callback_ <span class="op">=</span> <span class="va">str</span><span class="op">)</span></span></code></pre></div>
<p>This tells Chromote to call <code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code> (which prints to the console) on the message value every single time that a <code>Page.loadEventFired</code> event message is received. It will continue doing this indefinitely. (Calling an event method this way also increments the event callback counter.)</p>
<p>When an event method is called with a callback, the return value is a function which will cancel the callback, so that it will no longer fire. (The canceller function also decrements the event callback counter. If you lose the canceller function, there is no way to decrement the callback counter back to 0.)</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cancel_load_event_callback</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>callback_ <span class="op">=</span> <span class="va">str</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Each of these will cause the callback to fire.</span></span>
<span><span class="va">n1</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span><span class="op">)</span></span>
<span><span class="va">n2</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://cran.r-project.org/"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cancel_load_event_callback</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># No longer causes the callback to fire.</span></span>
<span><span class="va">n3</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.rstudio.com/"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="resource-cleanup-and-garbage-collection">Resource cleanup and garbage collection<a class="anchor" aria-label="anchor" href="#resource-cleanup-and-garbage-collection"></a>
</h2>
<p>When Chromote starts a Chrome process, it calls <code>Chrome$new()</code>. This launches the Chrome process it using <code><a href="http://processx.r-lib.org/reference/process.html" class="external-link">processx::process()</a></code>, and enables a supervisor for the process. This means that if the R process stops, the supervisor will detect this and shut down any Chrome processes that were registered with the supervisor. This prevents the proliferation of Chrome processes that are no longer needed.</p>
<p>The Chromote package will, by default, use a single Chrome process and a single <code>Chromote</code> object, and each time <code>ChromoteSession$new()</code> is called, it will spawn them from the <code>Chromote</code> object. See <a href="#the-chromote-object-model">The Chromote object model</a> for more information.</p>
</div>
<div class="section level2">
<h2 id="specifying-which-browser-to-use">Specifying which browser to use<a class="anchor" aria-label="anchor" href="#specifying-which-browser-to-use"></a>
</h2>
<p>Chromote will look in specific places for the Chrome web browser, depending on platform. This is done by the <code>chromote:::find_chrome()</code> function.</p>
<p>If you wish to use a different browser from the default, you can set the <code>CHROMOTE_CHROME</code> environment variable, either with <code>Sys.setenv(CHROMOTE_CHROME="/path/to/browser")</code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>CHROMOTE_CHROME <span class="op">=</span> <span class="st">"/Applications/Chromium.app/Contents/MacOS/Chromium"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.whatismybrowser.com/"</span><span class="op">)</span></span></code></pre></div>
<p>Another way is create a <code>Chromote</code> object and explicitly specify the browser, then spawn <code>ChromoteSession</code>s from it.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/Chromote.html">Chromote</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  browser <span class="op">=</span> <span class="va"><a href="reference/Chrome.html">Chrome</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/Applications/Chromium.app/Contents/MacOS/Chromium"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Spawn a ChromoteSession from the Chromote object</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="fu">new_session</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.whatismybrowser.com/"</span><span class="op">)</span></span></code></pre></div>
<p>Yet another way is to create a <code>Chromote</code> object with a specified browser, then set it as the default Chromote object.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/Chromote.html">Chromote</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  browser <span class="op">=</span> <span class="va"><a href="reference/Chrome.html">Chrome</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/Applications/Chromium.app/Contents/MacOS/Chromium"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set this Chromote object as the default. Then any</span></span>
<span><span class="co"># ChromoteSession$new() will be spawned from it.</span></span>
<span><span class="fu"><a href="reference/default_chromote_object.html">set_default_chromote_object</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.whatismybrowser.com/"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="chrome-on-remote-hosts">Chrome on remote hosts<a class="anchor" aria-label="anchor" href="#chrome-on-remote-hosts"></a>
</h2>
<p>Chromote can control a browser running on a remote host. To start the browser, open a terminal on the remote host and run one of the following, depending on your platform:</p>
<p><strong>Warning: Depending on how the remote machine is configured, the Chrome debug server might be accessible to anyone on the Internet. Proceed with caution.</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="co"># Mac</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="st">"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"</span> <span class="sc">--</span>headless \</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>  <span class="sc">--</span>remote<span class="sc">-</span>debugging<span class="sc">-</span>address<span class="ot">=</span><span class="dv">0</span>.<span class="dv">0</span>.<span class="fl">0.0</span> <span class="sc">--</span>remote<span class="sc">-</span>debugging<span class="sc">-</span>port<span class="ot">=</span><span class="dv">9222</span></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="co"># Linux</span></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>google<span class="sc">-</span>chrome <span class="sc">--</span>headless <span class="sc">--</span>remote<span class="sc">-</span>debugging<span class="sc">-</span>address<span class="ot">=</span><span class="dv">0</span>.<span class="dv">0</span>.<span class="fl">0.0</span> <span class="sc">--</span>remote<span class="sc">-</span>debugging<span class="sc">-</span>port<span class="ot">=</span><span class="dv">9222</span></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a><span class="co"># Windows</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a><span class="st">"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe"</span>  <span class="sc">--</span>headless \</span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a>  <span class="sc">--</span>remote<span class="sc">-</span>debugging<span class="sc">-</span>address<span class="ot">=</span><span class="dv">0</span>.<span class="dv">0</span>.<span class="fl">0.0</span> <span class="sc">--</span>remote<span class="sc">-</span>debugging<span class="sc">-</span>port<span class="ot">=</span><span class="dv">9222</span></span></code></pre></div>
<p>Then, in your local R session, create a Chromote object with the <code>host</code> and <code>port</code> (you will need to use the correct IP address). Once it’s created, you can spawn a session off of it which you can control as normal:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/Chromote.html">Chromote</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  browser <span class="op">=</span> <span class="va"><a href="reference/ChromeRemote.html">ChromeRemote</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>host <span class="op">=</span> <span class="st">"10.0.0.5"</span>, port <span class="op">=</span> <span class="fl">9222</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">r</span><span class="op">$</span><span class="fu">new_session</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Browser</span><span class="op">$</span><span class="fu">getVersion</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.whatismybrowser.com/"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"browser.png"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"browser_string.png"</span>, selector <span class="op">=</span> <span class="st">".string-major"</span><span class="op">)</span></span></code></pre></div>
<p>When you use <code>$view()</code> on the remote browser, your local browser may block scripts for security reasons, which means that you won’t be able to view the remote browser. If your local browser is Chrome, there will be a shield-shaped icon in the location bar that you can click in order to enable loading the scripts. (Note: Some browsers don’t seem to work at all with the viewer.)</p>
<p><strong>Technical note:</strong> There seem to be some timing issues with remote browsers. In the example above, the browser may finish navigating to the web site before the R process receives the response message for <code>$navigate()</code>, and therefore before R starts waiting for <code>Page.loadEventFired</code>. In order to avoid these timing problems, it is better to write code like this:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.whatismybrowser.com/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">b</span><span class="op">$</span><span class="fu">wait_for</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"browser.png"</span><span class="op">)</span></span></code></pre></div>
<p>This tells it to fire off the <code>Page.navigate</code> command and <em>not</em> wait for it, and then immediately start waiting for <code>Page.loadEventFired</code> event.</p>
<div class="section level3">
<h3 id="attaching-to-existing-tabs">Attaching to existing tabs<a class="anchor" aria-label="anchor" href="#attaching-to-existing-tabs"></a>
</h3>
<p>In the examples above, we connected to an existing browser, but created a new tab to attach to. It’s also possible to attach to an existing browser <em>and</em> and existing tab. In Chrome debugging terminology a tab is called a “Target”, and there is a command to retrieve the list of current Targets:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span><span class="op">$</span><span class="va">Target</span><span class="op">$</span><span class="fu">getTargets</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Every target has a unique identifier string associated with it called the <code>targetId</code>; <code>"9DAE349A3A533718ED9E17441BA5159B"</code> is an example of one.</p>
<p>Here we define a function that retrieves the ID of the first Target (tab) from a Chromote object:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_id</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ts</span> <span class="op">&lt;-</span> <span class="va">r</span><span class="op">$</span><span class="va">Target</span><span class="op">$</span><span class="fu">getTargets</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">targetInfos</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">r</span><span class="op">$</span><span class="va">Target</span><span class="op">$</span><span class="fu">getTargets</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">targetInfos</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">targetId</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The following code shows an alert box in the first tab, whatever it is:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromeRemote.html">ChromeRemote</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>host <span class="op">=</span> <span class="st">"localhost"</span>, port <span class="op">=</span> <span class="fl">9222</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/Chromote.html">Chromote</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>browser <span class="op">=</span> <span class="va">rc</span><span class="op">)</span></span>
<span><span class="va">tid</span> <span class="op">&lt;-</span> <span class="fu">first_id</span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">r</span><span class="op">$</span><span class="fu">new_session</span><span class="op">(</span>targetId <span class="op">=</span> <span class="va">tid</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Runtime</span><span class="op">$</span><span class="fu">evaluate</span><span class="op">(</span><span class="st">'alert("this is the first tab")'</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="loading-a-page-reliably">Loading a page reliably<a class="anchor" aria-label="anchor" href="#loading-a-page-reliably"></a>
</h3>
<p>In many cases, the commands <code>Page$navigate()</code> and then <code>$Page$loadEventFired()</code> will not reliably block until the page loads. For example:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Not reliable</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span><span class="op">)</span>  <span class="co"># Block until page has loaded</span></span></code></pre></div>
<p>This is because the browser might successfully navigate to the page before it receives the <code>loadEventFired</code> command from R.</p>
<p>In order to navigate to a page reliably, you must issue the <code>loadEventFired</code> command first in async mode, then issue the <code>navigate</code> command, and then wait for the <code>loadEventFired</code> promise to resolve. (If it has already resolved at this point, then the code will continue.)</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reliable method 1: for use with synchronous API</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># Get the promise for the loadEventFired</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Block until p resolves</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">wait_for</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add more synchronous commands here</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"browser.png"</span><span class="op">)</span></span></code></pre></div>
<p>The above code uses the async API to do the waiting, but then assumes that you want to write subsequent code with the synchronous API.</p>
<p>If you want to go fully async, then instead of calling <code>wait_for(p)</code>, you would simply chain more promises from <code>p</code>, using <code>$then()</code>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reliable method 2: for use with asynchronous API</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># Get the promise for the loadEventFired</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Chain more async commands after the page has loaded</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"browser.png"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This is explained in more detail in the <a href="#async-events">Async Events</a> section.</p>
</div>
<div class="section level3">
<h3 id="taking-a-screenshot-of-a-web-page">Taking a screenshot of a web page<a class="anchor" aria-label="anchor" href="#taking-a-screenshot-of-a-web-page"></a>
</h3>
<p>Take a screenshot of the viewport and display it using the <a href="https://github.com/r-lib/showimage#readme" class="external-link">showimage</a> package. This uses Chromote’s <code>$screenshot()</code> method, which wraps up many calls to the Chrome DevTools Protocol.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ==== Semi-synchronous version ====</span></span>
<span><span class="co"># Run the next two lines together, without any delay in between.</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">wait_for</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span>show <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># Saves to screenshot.png and displays in viewer</span></span>
<span></span>
<span><span class="co"># ==== Async version ====</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span>show <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>It is also possible to use selectors to specify what to screenshot, as well as the region (“content”, “border”, “padding”, or “margin”).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using CSS selectors, choosing the region, and using scaling</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"s1.png"</span>, selector <span class="op">=</span> <span class="st">".sidebar"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"s2.png"</span>, selector <span class="op">=</span> <span class="st">".sidebar"</span>, region <span class="op">=</span> <span class="st">"margin"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"s3.png"</span>, selector <span class="op">=</span> <span class="st">".page"</span>, region <span class="op">=</span> <span class="st">"margin"</span>, scale <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>If a vector is passed to <code>selector</code>, it will take a screenshot with a rectangle that encompasses all the DOM elements picked out by the selectors. Similarly, if a selector picks out multiple DOM elements, all of them will be in the screenshot region.</p>
</div>
<div class="section level3">
<h3 id="setting-width-and-height-of-the-viewport-window">Setting width and height of the viewport (window)<a class="anchor" aria-label="anchor" href="#setting-width-and-height-of-the-viewport-window"></a>
</h3>
<p>The default size of a <code>ChromoteSession</code> viewport is 992 by 1323 pixels. You can set the width and height when it is created:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">390</span>, height <span class="op">=</span> <span class="fl">844</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org/"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"narrow.png"</span><span class="op">)</span></span></code></pre></div>
<p>With an existing <code>ChromoteSession</code>, you can set the size with <code>b$Emulation$setVisibleSize()</code>:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="va">Emulation</span><span class="op">$</span><span class="fu">setVisibleSize</span><span class="op">(</span>width<span class="op">=</span><span class="fl">1600</span>, height<span class="op">=</span><span class="fl">900</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"wide.png"</span><span class="op">)</span></span></code></pre></div>
<p>You can take a “Retina” (double) resolution screenshot by using <code>b$screenshot(scale=2)</code>:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"wide-2x.png"</span>, scale <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="taking-a-screenshot-of-a-web-page-after-interacting-with-it">Taking a screenshot of a web page after interacting with it<a class="anchor" aria-label="anchor" href="#taking-a-screenshot-of-a-web-page-after-interacting-with-it"></a>
</h3>
<p>Headless Chrome provides a remote debugging UI which you can use to interact with the web page. The ChromoteSession’s <code>$view()</code> method opens a regular browser and navigates to the remote debugging UI.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.google.com"</span><span class="op">)</span> <span class="co"># Or just type the URL in the navigation bar</span></span></code></pre></div>
<p>At this point, you can interact with the web page by typing in text and clicking on things.</p>
<p>Then take a screenshot:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="taking-screenshots-of-web-pages-in-parallel">Taking screenshots of web pages in parallel<a class="anchor" aria-label="anchor" href="#taking-screenshots-of-web-pages-in-parallel"></a>
</h3>
<p>With async code, it’s possible to navigate to and take screenshots of multiple websites in parallel.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/promises/" class="external-link">promises</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/chromote/">chromote</a></span><span class="op">)</span></span>
<span><span class="va">urls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.r-project.org/"</span>,</span>
<span>  <span class="st">"https://github.com/"</span>,</span>
<span>  <span class="st">"https://news.ycombinator.com/"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">screenshot_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span>, <span class="va">filename</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">filename</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^.*://"</span>, <span class="st">""</span>, <span class="va">url</span><span class="op">)</span></span>
<span>    <span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"/"</span>, <span class="st">"_"</span>, <span class="va">filename</span><span class="op">)</span></span>
<span>    <span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\."</span>, <span class="st">"_"</span>, <span class="va">filename</span><span class="op">)</span></span>
<span>    <span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"_$"</span>, <span class="st">""</span>, <span class="va">filename</span><span class="op">)</span></span>
<span>    <span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filename</span>, <span class="st">".png"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="va">url</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">p</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="va">filename</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">filename</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">finally</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">b</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Screenshot multiple simultaneously</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">urls</span>, <span class="va">screenshot_p</span><span class="op">)</span></span>
<span><span class="va">pa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/promises/reference/promise_all.html" class="external-link">promise_all</a></span><span class="op">(</span>.list <span class="op">=</span> <span class="va">ps</span><span class="op">)</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Done!"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Block the console until the screenshots finish (optional)</span></span>
<span><span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/default_chromote_object.html">default_chromote_object</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cm</span><span class="op">$</span><span class="fu">wait_for</span><span class="op">(</span><span class="va">pa</span><span class="op">)</span></span>
<span><span class="co">#&gt; www_r-project_org.png</span></span>
<span><span class="co">#&gt; github_com.png</span></span>
<span><span class="co">#&gt; news_ycombinator_com.png</span></span>
<span><span class="co">#&gt; Done!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setting-custom-headers">Setting custom headers<a class="anchor" aria-label="anchor" href="#setting-custom-headers"></a>
</h3>
<p>Currently setting custom headers requires a little extra work because it requires <code>Network.enable</code> be called before using it. In the future we’ll streamline things so that it will happen automatically.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Currently need to manually enable Network domain notifications. Calling</span></span>
<span><span class="co"># b$Network$enable() would do it, but calling it directly will bypass the</span></span>
<span><span class="co"># callback counting and the notifications could get automatically disabled by a</span></span>
<span><span class="co"># different Network event. We'll enable notifications for the Network domain by</span></span>
<span><span class="co"># listening for a particular event. We'll also store a callback that will</span></span>
<span><span class="co"># decrement the callback counter, so that we can disable notifications ater.</span></span>
<span><span class="va">disable_network_notifications</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Network</span><span class="op">$</span><span class="fu">responseReceived</span><span class="op">(</span><span class="kw">function</span> <span class="op">(</span><span class="va">msg</span><span class="op">)</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Network</span><span class="op">$</span><span class="fu">setExtraHTTPHeaders</span><span class="op">(</span>headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  foo <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>  header1 <span class="op">=</span> <span class="st">"value1"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visit a web page that prints out the request headers</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"http://scooterlabs.com/echo"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span>show <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Unset extra headers. Note that `list(a=1)[0]` creates an empty _named_ list;</span></span>
<span><span class="co"># an empty unnamed list will cause an error because they're converted to JSON</span></span>
<span><span class="co"># differently. A named list becomes "{}", but an unnamed list becomes "[]".</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Network</span><span class="op">$</span><span class="fu">setExtraHTTPHeaders</span><span class="op">(</span>headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Request again</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"http://scooterlabs.com/echo"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span>show <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Disable extra headers entirely, by decrementing Network callback counter,</span></span>
<span><span class="co"># which will disable Network notifications.</span></span>
<span><span class="fu">disable_network_notifications</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-user-agent">Custom User-Agent<a class="anchor" aria-label="anchor" href="#custom-user-agent"></a>
</h3>
<p>Synchronous version:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ==== Synchronous version ====</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Network</span><span class="op">$</span><span class="fu">setUserAgentOverride</span><span class="op">(</span>userAgent <span class="op">=</span> <span class="st">"My fake browser"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"http://scooterlabs.com/echo"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span>show <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ==== Async version ====</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Network</span><span class="op">$</span><span class="fu">setUserAgentOverride</span><span class="op">(</span>userAgent <span class="op">=</span> <span class="st">"My fake browser"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"http://scooterlabs.com/echo"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span>show <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-text-from-a-web-page">Extracting text from a web page<a class="anchor" aria-label="anchor" href="#extracting-text-from-a-web-page"></a>
</h3>
<p>One way to extract text from a page is to tell the browser to run JavaScript code that does it:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ==== Synchronous version ====</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.whatismybrowser.com/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run JavaScript to extract text from the page</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Runtime</span><span class="op">$</span><span class="fu">evaluate</span><span class="op">(</span><span class="st">'document.querySelector(".corset .string-major a").innerText'</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] "Chrome 75 on macOS (Mojave)"</span></span>
<span></span>
<span></span>
<span><span class="co"># ==== Async version ====</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.whatismybrowser.com/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="va">Runtime</span><span class="op">$</span><span class="fu">evaluate</span><span class="op">(</span></span>
<span>      <span class="st">'document.querySelector(".corset .string-major a").innerText'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">value</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Another way is to use CDP commands to extract content from the DOM. This does not require executing JavaScript in the browser’s context, but it is also not as flexible as JavaScript.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ==== Synchronous version ====</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.whatismybrowser.com/"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="st">".corset .string-major a"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getOuterHTML</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">nodeId</span><span class="op">)</span></span>
<span><span class="co">#&gt; $outerHTML</span></span>
<span><span class="co">#&gt; [1] "&lt;a href=\"/detect/what-version-of-chrome-do-i-have\"&gt;Chrome 75 on macOS (Mojave)&lt;/a&gt;"</span></span>
<span></span>
<span></span>
<span><span class="co"># ==== Async version ====</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span>wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.whatismybrowser.com/"</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getDocument</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">querySelector</span><span class="op">(</span><span class="va">value</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">nodeId</span>, <span class="st">".corset .string-major a"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">b</span><span class="op">$</span><span class="va">DOM</span><span class="op">$</span><span class="fu">getOuterHTML</span><span class="op">(</span><span class="va">value</span><span class="op">$</span><span class="va">nodeId</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="websites-that-require-authentication">Websites that require authentication<a class="anchor" aria-label="anchor" href="#websites-that-require-authentication"></a>
</h3>
<p>For websites that require authentication, you can use Chromote to get screenshots by doing the following:</p>
<ol style="list-style-type: decimal">
<li>Log in interactively and navigate to the page.</li>
<li>Capture cookies from the page and save them.</li>
<li>In a later R session, load the cookies.</li>
<li>Use the cookies in Chromote and navigate to the page.</li>
<li>Take a screenshot.</li>
</ol>
<p>There are two ways to capture the cookies.</p>
<p><strong>Method 1:</strong> The first method uses the headless browser’s viewer. This can be a bit inconvenient because it requires going through the entire login process, even if you have already logged in with a normal browser.</p>
<p>First navigate to the page:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/chromote/">chromote</a></span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://beta.rstudioconnect.com/content/123456/"</span><span class="op">)</span></span></code></pre></div>
<p>Next, log in interactively via the viewer. Once that’s done, use Chromote to capture the cookies.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cookies</span> <span class="op">&lt;-</span> <span class="va">b</span><span class="op">$</span><span class="va">Network</span><span class="op">$</span><span class="fu">getCookies</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">cookies</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">cookies</span>, <span class="st">"cookies.rds"</span><span class="op">)</span></span></code></pre></div>
<p>After saving the cookies, you can restart R and navigate to the page, using the cookies.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/chromote/">chromote</a></span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cookies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"cookies.rds"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Network</span><span class="op">$</span><span class="fu">setCookies</span><span class="op">(</span>cookies <span class="op">=</span> <span class="va">cookies</span><span class="op">$</span><span class="va">cookies</span><span class="op">)</span></span>
<span><span class="co"># Navigate to the app that requires a login</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://beta.rstudioconnect.com/content/123456/"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><strong>Method 2:</strong> The second method captures the cookies using a normal browser. This is can be more convenient because, if you are already logged in, you don’t need to do it again. This requires a Chromium-based browser, and it requires running DevTools-in-DevTools on that browser.</p>
<p>First, navigate to the page in your browser. Then press CMD-Option-I (Mac) or Ctrl-Shift-I (Windows/Linux). The developer tools panel will open. Make sure to undock the developer tools so that they are in their own window. Then press CMD-Option-I or Ctrl-Shift-I again. A second developer tools window will open. (See <a href="https://stackoverflow.com/questions/12291138/how-do-you-inspect-the-web-inspector-in-chrome/12291163#12291163" class="external-link">this SO answer</a> for detailed instructions.)</p>
<p>In the second developer tools window, run the following:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="kw">var</span> cookies <span class="op">=</span> <span class="cf">await</span> Main<span class="op">.</span><span class="fu">sendOverProtocol</span>(<span class="st">'Network.getCookies'</span><span class="op">,</span> {})</span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a><span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(cookies)</span></code></pre></div>
<p>This will return a JSON string representing the cookies for that page. For example:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="ot">[</span><span class="fu">{</span><span class="dt">"cookies"</span><span class="fu">:</span><span class="ot">[</span><span class="fu">{</span><span class="dt">"name"</span><span class="fu">:</span><span class="st">"AWSALB"</span><span class="fu">,</span><span class="dt">"value"</span><span class="fu">:</span><span class="st">"T3dNdcdnMasdf/cNn0j+JHMVkZ3RI8mitnAggd9AlPsaWJdsfoaje/OowIh0qe3dDPiHc0mSafe5jNH+1Aeinfalsd30AejBZDYwE"</span><span class="fu">,</span><span class="dt">"domain"</span><span class="fu">:</span><span class="st">"beta.rstudioconnect.com"</span><span class="fu">,</span><span class="dt">"path"</span><span class="fu">:</span><span class="st">"/"</span><span class="fu">,</span><span class="dt">"expires"</span><span class="fu">:</span><span class="fl">1594632233.96943</span><span class="fu">,</span><span class="dt">"size"</span><span class="fu">:</span><span class="dv">130</span><span class="fu">,</span><span class="dt">"httpOnly"</span><span class="fu">:</span><span class="kw">false</span><span class="fu">,</span><span class="dt">"secure"</span><span class="fu">:</span><span class="kw">false</span><span class="fu">,</span><span class="dt">"session"</span><span class="fu">:</span><span class="kw">false</span><span class="fu">}</span><span class="ot">]</span><span class="fu">}</span><span class="ot">]</span></span></code></pre></div>
<p>Copy that string to the clipboard. In your R session, you can paste it to this code, surrounded by single-quotes:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cookie_json</span> <span class="op">&lt;-</span> <span class="st">'[{"cookies":[{"name":"AWSALB","value":"T3dNdcdnMasdf/cNn0j+JHMVkZ3RI8mitnAggd9AlPsaWJdsfoaje/OowIh0qe3dDPiHc0mSafe5jNH+1Aeinfalsd30AejBZDYwE","domain":"beta.rstudioconnect.com","path":"/","expires":1594632233.96943,"size":130,"httpOnly":false,"secure":false,"session":false}]}]'</span></span>
<span></span>
<span><span class="va">cookies</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">cookie_json</span>, simplifyVector <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Then you can use Chromote to navigate to the page and take a screenshot.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/chromote/">chromote</a></span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Network</span><span class="op">$</span><span class="fu">setCookies</span><span class="op">(</span>cookies <span class="op">=</span> <span class="va">cookies</span><span class="op">$</span><span class="va">cookies</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://beta.rstudioconnect.com/content/123456/"</span><span class="op">)</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=chromote" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/rstudio/chromote/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/rstudio/chromote/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2" class="external-link">GPL-2</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing chromote</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/wch" class="external-link">Winston Chang</a> <br><small class="roles"> Author, maintainer </small>  </li>
<li>
<a href="http://schloerke.com" class="external-link">Barret Schloerke</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-9986-114X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Garrick Aden-Buie <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-7111-0077" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a> <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/rstudio/chromote/actions" class="external-link"><img src="https://github.com/rstudio/chromote/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://CRAN.R-project.org/package=chromote" class="external-link"><img src="https://www.r-pkg.org/badges/version/chromote" alt="CRAN status"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/wch" class="external-link">Winston Chang</a>, <a href="http://schloerke.com" class="external-link">Barret Schloerke</a>, Garrick Aden-Buie, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
