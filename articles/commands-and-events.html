<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Commands and events • chromote</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Commands and events">
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">chromote</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/chromote.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/commands-and-events.html">Commands and events</a></li>
    <li><a class="dropdown-item" href="../articles/sync-async.html">Synchronous vs. asynchronous usage</a></li>
    <li><a class="dropdown-item" href="../articles/which-chrome.html">Choosing which Chrome-based browser to use</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/example-loading-page.html">Loading a page reliably</a></li>
    <li><a class="dropdown-item" href="../articles/example-screenshot.html">Taking a screenshot of a web page</a></li>
    <li><a class="dropdown-item" href="../articles/example-extract-text.html">Extracting text from a web page</a></li>
    <li><a class="dropdown-item" href="../articles/example-attach-existing.html">Attaching to existing tabs</a></li>
    <li><a class="dropdown-item" href="../articles/example-authentication.html">Websites that require authentication</a></li>
    <li><a class="dropdown-item" href="../articles/example-cran-tests.html">Using chromote in CRAN tests</a></li>
    <li><a class="dropdown-item" href="../articles/example-custom-headers.html">Setting custom headers</a></li>
    <li><a class="dropdown-item" href="../articles/example-custom-user-agent.html">Setting custom user agent</a></li>
    <li><a class="dropdown-item" href="../articles/example-remote-hosts.html">Chrome on remote hosts</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://shiny.posit.co/blog/posts/chromote-0.5.0/">v0.5.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/chromote/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Commands and events</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/chromote/blob/rc-v0.5.0/vignettes/commands-and-events.Rmd" class="external-link"><code>vignettes/commands-and-events.Rmd</code></a></small>
      <div class="d-none name"><code>commands-and-events.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="commands-and-events">Commands and Events<a class="anchor" aria-label="anchor" href="#commands-and-events"></a>
</h2>
<p>The Chrome DevTools Protocol has two types of methods:
<em>commands</em> and <em>events</em>. Methods like
<code>Page$navigate()</code> and <code>DOM$querySelector()</code> are
<strong>commands</strong>. That is, they tell the browser to do
something; the browser does it, and then sends back some data.</p>
<p><strong>Events</strong> are quite different from commands. When, for
example, you run <code>b$Page$loadEventFired()</code>, it does not send
a message to the browser. Rather, this method tells the R process to
wait until it receives a <code>Page.loadEventFired</code> message from
the browser.</p>
<p>Here is an example of how that event can be used. Note that these two
lines of code must be run together, without any delay at all (this can
be enforced by wrapping both lines of code in
<code>{ .... }</code>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/chromote/">chromote</a></span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ChromoteSession.html">ChromoteSession</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Send a command to navigate to a page</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">navigate</span><span class="op">(</span><span class="st">"https://www.r-project.org"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $frameId</span></span>
<span><span class="co">#&gt; [1] "0ADE3CFBAF764B0308ADE1ACCC33358B"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $loaderId</span></span>
<span><span class="co">#&gt; [1] "112AF4AC0C13FF4A95BED8173C3F4C7F"</span></span>
<span></span>
<span><span class="co"># Wait for the Page.loadEventFired event</span></span>
<span><span class="va">b</span><span class="op">$</span><span class="va">Page</span><span class="op">$</span><span class="fu">loadEventFired</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $timestamp</span></span>
<span><span class="co">#&gt; [1] 680.7603</span></span></code></pre></div>
<p>After running these two lines, the R process will be blocked. While
it’s blocked, the browser will load the page, and then send a message to
the R process saying that the <code>Page.loadEventFired</code> event has
occurred. The message looks something like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">{</span><span class="dt">"method"</span><span class="fu">:</span><span class="st">"Page.loadEventFired"</span><span class="fu">,</span><span class="dt">"params"</span><span class="fu">:{</span><span class="dt">"timestamp"</span><span class="fu">:</span><span class="fl">699232.345338</span><span class="fu">}}</span></span></code></pre></div>
<p>After the R process receives this message, the function returns the
value, which looks like this:</p>
<pre><code>$timestamp
[1] 699232.3</code></pre>
<blockquote>
<p><strong>Note:</strong> This sequence of commands, with
<code>Page$navigate()</code> and then <code>Page$loadEventFired()</code>
works interactively when you run the commands slowly, but it will not
work 100% of the time. See <code><a href="../articles/example-loading-page.html">vignette("example-loading-page")</a></code>
for a reliable approach to page loading that works in all
situations.</p>
</blockquote>
<div class="section level3">
<h3 id="automatic-events">Automatic Events<a class="anchor" aria-label="anchor" href="#automatic-events"></a>
</h3>
<p>Chromote insulates the user from some of the details of how the CDP
implements event notifications. Event notifications are not sent from
the browser to the R process by default; you must first send a command
to enable event notifications for a domain. For example
<code>Page.enable</code> enables event notifications for the
<code>Page</code> domain – the browser will send messages for
<em>all</em> <code>Page</code> events. (See the Events section in <a href="https://chromedevtools.github.io/devtools-protocol/tot/Page/" class="external-link">this
page</a>). These notifications will continue to be sent until the
browser receives a <code>Page.disable</code> command.</p>
<p>By default, Chromote hides this implementation detail. When you call
<code>b$Page$loadEventFired()</code>, Chromote sends a
<code>Page.enable</code> command automatically, and then waits until it
receives the <code>Page.loadEventFired</code> event notification. Then
it sends a <code>Page.disable</code> command.</p>
<p>Note that in asynchronous mode, the behavior is slightly more
sophisticated: it maintains a counter of how many outstanding events it
is waiting for in a given domain. When that count goes from 0 to 1, it
sends the <code>X.enable</code> command; when the count goes from 1 to
0, it sends the <code>X.disable</code> command. For more information,
see <code><a href="../articles/sync-async.html">vignette("sync-async")</a></code>.</p>
<p>If you need to customize the arguments used by the automatically-run
<code>enable</code> command, you can use the
<code>$auto_events_enable_args()</code> method of a
<code>Chromote</code> or <code>ChromoteSession</code> instance,
e.g. <code>b$auto_events_enable_args("Page", enableFileChooserOpenedEvent = TRUE)</code>.</p>
<p>If you do not want automatic event enabling and disabling, then when
creating the ChromoteSession object, use
<code>ChromoteSession$new(auto_events = FALSE)</code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://garrickadenbuie.com" class="external-link">Garrick Aden-Buie</a>, <a href="https://github.com/wch" class="external-link">Winston Chang</a>, <a href="http://schloerke.com" class="external-link">Barret Schloerke</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
